<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rugby ROC - Office Display (16:9 Optimized)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #0a0a0a;
      color: #fafafa;
      font-family: Arial, Helvetica, sans-serif;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      padding: 1rem 2rem;
      box-sizing: border-box;
    }

    .top-section {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .weather-card, .header-card {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 1rem 1.5rem;
      flex: 1;
      min-width: 350px;
    }

    .weather-card {
      background: rgba(27, 140, 155, 0.1);
      border: 1px solid rgba(27, 140, 155, 0.2);
      max-width: 350px;
    }

    .branding {
      display: flex;
      align-items: center;
    }

    .branding img {
      height: 70px;
      margin-right: 1rem;
    }

    .header-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      flex-wrap: wrap;
    }

    .clock {
      text-align: right;
      font-size: 1.5rem;
    }

    .news-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
      grid-gap: 1.5rem;
      margin-top: 1.5rem;
      overflow-y: auto;
      padding-bottom: 1rem;
    }

    .news-card {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 300px;
    }

    .news-image {
      width: 100%;
      height: 60%;
      object-fit: cover;
      background: #1B8C9B;
    }

    .news-content {
      padding: 0.75rem 1rem;
      font-size: 1rem;
    }

    .loading, .error {
      text-align: center;
      padding: 2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-section">
      <div class="weather-card" id="weather-widget">
        <div class="loading">Loading weather...</div>
      </div>

      <div class="header-card">
        <div class="header-info">
          <div class="branding">
            <img src="logo.jpg" alt="WCS Logo">
            <div>
              <h1 style="margin: 0; font-size: 2.2rem;">Rugby ROC</h1>
              <p style="margin: 0; color: #a1a1aa;">Live News & Information</p>
            </div>
          </div>
          <div class="clock">
            <div id="clock-time">--:--:--</div>
            <div id="clock-date" style="font-size:1rem;color:#a1a1aa;">Loading...</div>
          </div>
        </div>
      </div>
    </div>

    <div class="news-grid" id="news-grid">
      <div class="loading">Loading latest news...</div>
    </div>
  </div>

  <script>
    if (!window.fetch) {
      window.fetch = function (url) {
        return new Promise(function (resolve, reject) {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', url);
          xhr.onload = function () {
            if (xhr.status >= 200 && xhr.status < 300) {
              resolve({ text: function() { return Promise.resolve(xhr.responseText); } });
            } else reject(new Error(xhr.statusText));
          };
          xhr.onerror = function () { reject(new Error('Network Error')); };
          xhr.send();
        });
      };
    }

    var BBC_NEWS_URL = 'https://feeds.bbci.co.uk/news/rss.xml';
    var BBC_WEATHER_URL = 'https://weather-broker-cdn.api.bbci.co.uk/en/forecast/rss/3day/2639965';
    var CORS_PROXY = 'https://api.allorigins.win/raw?url=';

    function updateClock() {
      var now = new Date();
      document.getElementById('clock-time').textContent = now.toLocaleTimeString('en-GB');
      document.getElementById('clock-date').textContent = now.toLocaleDateString('en-GB', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    }
    setInterval(updateClock, 1000);
    updateClock();

    function parseXML(str) {
      var parser = new DOMParser();
      return parser.parseFromString(str, 'text/xml');
    }

    function getText(el, tag) {
      var node = el.getElementsByTagName(tag)[0];
      return node ? node.textContent : '';
    }

    function getWeatherIcon(cond) {
      var c = cond.toLowerCase();
      if (c.indexOf('rain') > -1) return 'üåßÔ∏è';
      if (c.indexOf('cloud') > -1) return '‚òÅÔ∏è';
      if (c.indexOf('sun') > -1 || c.indexOf('clear') > -1) return '‚òÄÔ∏è';
      if (c.indexOf('snow') > -1) return '‚ùÑÔ∏è';
      return 'üå§Ô∏è';
    }

    function loadWeather() {
      fetch(CORS_PROXY + encodeURIComponent(BBC_WEATHER_URL))
        .then(function(r){ return r.text(); })
        .then(function(t){
          var xml = parseXML(t);
          var items = xml.getElementsByTagName('item');
          if (!items.length) throw new Error('No weather data');
          var title = getText(items[0],'title');
          var desc = getText(items[0],'description');
          var tempMatch = desc.match(/(\d+)¬∞C/);
          var temp = tempMatch ? tempMatch[1]+'¬∞C' : 'N/A';
          var html = '<div style="font-size:1.2rem;margin-bottom:0.5rem;">Rugby, UK</div>'+
                     '<div style="font-size:2.5rem;">'+getWeatherIcon(title)+' '+temp+'</div>'+
                     '<div style="font-size:1rem;color:#a1a1aa;">'+title+'</div>';
          document.getElementById('weather-widget').innerHTML = html;
        })
        .catch(function(){
          document.getElementById('weather-widget').innerHTML = '<div class="error">Unable to load weather</div>';
        });
    }

    function loadNews() {
      fetch(CORS_PROXY + encodeURIComponent(BBC_NEWS_URL))
        .then(function(r){ return r.text(); })
        .then(function(t){
          var xml = parseXML(t);
          var items = xml.getElementsByTagName('item');
          var html = '';
          for (var i = 0; i < Math.min(12, items.length); i++) {
            var title = getText(items[i], 'title');
            var desc = getText(items[i], 'description');
            var imageUrl = '';

            var mediaThumb = items[i].getElementsByTagName('media:thumbnail')[0];
            var mediaContent = items[i].getElementsByTagName('media:content')[0];
            if (mediaThumb && mediaThumb.getAttribute('url')) {
              imageUrl = mediaThumb.getAttribute('url');
            } else if (mediaContent && mediaContent.getAttribute('url')) {
              imageUrl = mediaContent.getAttribute('url');
            } else {
              var match = desc.match(/<img[^>]+src=\"([^\"]+)\"/i);
              if (match) imageUrl = match[1];
            }

            html += '<div class="news-card">' +
                      (imageUrl ? '<img src="'+imageUrl+'" class="news-image" alt="'+title+'">'
                                : '<div class="news-image"></div>') +
                      '<div class="news-content"><h3>'+title+'</h3><p>'+desc+'</p></div>' +
                    '</div>';
          }
          document.getElementById('news-grid').innerHTML = html;
        })
        .catch(function(){
          document.getElementById('news-grid').innerHTML = '<div class="error">Unable to load news</div>';
        });
    }

    loadWeather();
    loadNews();
    setInterval(loadWeather, 10*60*1000);
    setInterval(loadNews, 5*60*1000);
  </script>
</body>
</html>
